# Проектная работа "Веб-ларек"

"Web-ларёк" - это интернет-магазин с товарами для веб-разработчиков. В нём можно посмотреть каталог товаров, добавить товары в корзину и сделать заказ. 

Стек: HTML, SCSS, TS, Webpack

Структура проекта:
- src/ — исходные файлы проекта
- src/components/ — папка с JS компонентами
- src/components/base/ — папка с базовым кодом
- src/components/model - папка с компонентами модели данных
- src/components/view - папка с компонентами представления

Важные файлы:
- src/pages/index.html — HTML-файл главной страницы
- src/types/index.ts — файл с типами
- src/index.ts — точка входа приложения
- src/scss/styles.scss — корневой файл стилей
- src/utils/constants.ts — файл с константами
- src/utils/utils.ts — файл с утилитами

## Установка и запуск
Для установки и запуска проекта необходимо выполнить команды

```
npm install
npm run start
```

или

```
yarn
yarn start
```
## Сборка

```
npm run build
```

или

```
yarn build
```

## Архитектура приложения

Приложение построено в соответствии с шаблоном проектирования 
архитектуры приложений MVP (Model-View-Presenter) и представлено 
тремя слоями, что обеспечивает разделение ответственности между 
слоями так, чтобы изменения в одном из них не влияли на другие:

- слой данных (Model) отвечает за хранение и изменение данных;
- слой представления (View) занимается отображением данных на странице;
- слой презентера (Presenter) обеспечивает взаимодействие между представлением и данными.

## Ключевые типы данных.

Описание интерфейса карточки продукта
```
interface IProduct {
  id: string;
  image: string;
  title: string;
  category: string;
  price: number | null;
};
```

Описание интерфейса для превью карточки продукта
```
interface IProductPreview {
  description: string;
}
```

Описание типа для карточки товара в корзине
```
type IBasketItem = Pick<IProduct, 'id' | 'title' | 'price'>;
```

Описание интерфейса корзины
```
interface IBasket {
  products: string[];
  totalPrice: number;
}
```

Интерфейс для заказа

```
interface IOrder {
  email: string;
  address: string;
  phone: string;
  total: number;
}
```
Интерфейс для модального окна после оформления заказа

```
interface IOrderResult {
    id: string;
    total: string;
}
```

Описание типа ошибок формы

```
type FormErrors = Partial<Record<keyof IOrder, string>>;
```

Описание интерфейса для всех данных приложения

```
interface IAppState {
    catalog: IProduct[];
    basket: string[];
    preview: string | null;
    order: IOrder | null;
}
```

### Базовый код

#### Класс EventEmitter
---

Реализует паттерн «Наблюдатель» и позволяет подписываться на события и уведомлять подписчиков о наступлении события.

Поле класса:

`_events` - принимает название события и список подписчиков.

Методы класса: 

- `on` — для подписки на событие, 
- `off` - для отписки от события,
- `emit` - уведомления подписчиков о наступлении события.
- `onAll` - для подписки на все события,
- `offAll` - для отмены подписок всех подписчиков.
- `trigger` - генерирует заданное событие с заданными аргументами. Это позволяет передавать его в качестве обработчика события в другие классы. Эти классы будут генерировать события, не будучи при этом напрямую зависимыми от класса  EventEmitter.

#### Класс Api
---

Содержит в себе базовую логику отправки запросов серверу. В конструктор класса передаётся базовый адрес сервера и опциональный объект с заголовками запросов.

В полях класса хранятся следующие данные: 

- `baseUrl` - принимает и хранит изменяющуюся часть url-адреса.
- `options` - дополнительный параметр, который может содержать заголовки запроса.

Методы класса: 

- `handleResponse` - обработчик ответа сервера,
- `get` - выполняет GET-запрос на указанный в параметрах адрес и возвращает промис с объектом ответа от сервера,
- `post` - примнимает объект с данными, которые будут переданы в теле JSON запроса по адресу, указанному в параметрах запроса при вызове метода. По умолчанию метод определён как `POST` запрос, но может быть переопределён заданием третьего параметра при вызове (`PUT`, `DELETE`).

#### Класс Component<T>
---
 Абстрактный класс дженерик для создания компонентов пользовательского интерфейса.

 Конструктор класса `protected constructor(protected readonly container: HTMLElement)` принимает HTML-элемент контейнера, в который будет помещён компонент.
 
 Методы класса:
 - `toggle class` - метод для переключения класса элемента,
 - `set disabled` - метод для блокирования или разблокирования,переданного элемента в зависимости от значения state (true/false),
 - `set text` - метод для присваивания текста переданному элементу,
 - `set image` - метод для установки изображения элемента и атрибута `alt`,
 - `render` - метод для отрисовки DOM-элемента.
 
 #### Класс Model<T>
 ---
 Абстрактный класс дженерик для расширения класса `Component<T>` и метода привязки события.

 Конструктор класса `constructor(container: HTMLElement, protected readonly events: IEvents)` принимает элемент контейнера, в который будет помещён компонент и брокер событий.

 Методы класса наследуются от класса `Component<T>`.

### Компоненты модели данных (Model)
Позволяют хранить и обрабатывать данные, полученные от сервера и от пользователя.

#### Класс ApiModel
---
Класс обеспечивает работу с сетевыми запросами в проекте. Наследуется от базового класса Api.

Методы класса:
- `get productList` - получение массива с карточками товаров от сервера,
- `get product` - получение карточки товара по её id,
- `order products` - отправка объекта с данными заказа на сервер.

#### Класс AppState
---
Класс, описывающий состояние приложения, реализует интерфейс `IAppState`.

В полях класса хранятся следующие данные:
- `basket` - данные товара, добавленного в корзину,
- `catalog` - данные списка товаров, полученных от сервера,
- `order` - данные заказа для отправки на сервер,
- `preview` - данные товара, выбранного пользователем для просмотра,
- `formErrors` - данные ошибок полей формы.

Методы класса:
- `set product` - добавляет товар в корзину,
- `delete product` - удаляет товар из корзины,
- `clear basket` - очищает корзину от данных пользователя,
- `set catalog` - сохраняет коллекцию товаров, полученную от сервера,
- `set preview` - сохраняет карточку для просмотра в модальном окне,
- `get counter` - возвращает количество товаров в корзине,
- `get totalPrice` - возвращает общую стоимость товаров в корзине (должен учитывать возможность появления бесценного товара, то есть товара со стоимостью null, в составе массива товаров и как единственного товара. В случае, если бесценный товар единственный в корзине, стоимость товаров приравнивается к нулю, товар исключается из массива товаров для отправки на сервер).

### Компоненты представления (View)
Позволяют отображать элементы страницы с полученными данными и взаимодействовать с пользователем.

#### Класс Product
---
Класс, описывающий карточку товара. Отображается в каталоге товаров на 
главной странице, в модальном окне с просмотром выбранной карточки и в 
корзине. Расширяется базовым абстрактным классом `Component<T>`, должен
соответствовать интерфейсу `IProduct`.

Методы класса:
- `set title` - устанавливает название продукта,
- `set category` - устанавливает катгорию продукта,
- `set image` - устанавливает изображение товара,
- `set price` - устанавливает цену товара,
- `set description` - устанавливает описание товара.

### Класс ProductPreview
---
Класс отображает карточку товара в модальном окне просмотра, соответствует интерфейсу `IProductPreview`.

Метод класса:
- `set description` - устанавливает текст описания продукта.

### Класс BasketItem
---
Класс отвечает за отображение единицы товара в корзине, объект должен соответствовать интерфейсу `IBasketItem`.

Методы класса:
- `set title` - устанавливает название продукта,
- `set price` - устанавливает цену продукта,
- `set orderNumber` - устанавливает порядковый номер товара в корзине.

### Класс Page
---
Отображает данные на главной странице - каталог товаров, счётчик товаров, добавленных в корзину. Конструктор класса принимает в качестве параметров HTML-элемент и брокер событий.

Методы класса: 
- `set counter` - отрисовка счётчика товаров в корзине,
- `set catalog` - отрисовка списка товаров.

### Класс Modal
---
Класс для реализации модального окна. 
Содержит методы для открытия и закрытия модального окна, устанавливает слушатели на клавишу ESC (закрытие модального окна при нажатии), на оверлей (закрытие при клике) и кнопку закрытия модального окна (закрытие при клике).

### Класс BasketModal 
---
Класс отвечает за отрисовку корзины, расширяет класс Modal.

Методы класса:
- `set list` - отрисовывает список добавленных в корзину товаров,
- `set totalPrice` - отрисовывает итоговую стоиомость всех добавленных товаров,
- `render` - отрисовывает товары в корзине и их итоговую стоимость.

### Класс OrderModal
---
Класс управляет отображением модального окна с данными пользовтаеля - , электронная почта, телефон и способ оплаты.

Методы класса:
- `set address` - устанавливает адрес пользователя,
- `set payMethod` - устанавливает класс активности на кнопку, соответствующую выбору метода оплаты пользователем.

### Класс ContactsModal
---
Класс управляет отображением модального окна с данными пользователя - адрес доставки.

Методы класса: 
- `set email` - устанавливает адрес электронной почты пользователя,
- `set phone` - устанавливает номер телефона пользователя.

### Класс SuccsessModal
---
Класс отвечает за отображение модального окна с уведомлением об успешности оформления заказа.

Метод класса:
- `set price` - отображает итоговую стоимость заказа.

## Презентер (Presenter)
Презентер отвечает за обеспечение связи и взаимодействия между представлением и данными. Он не выделен в отдельный файл и будет описан в файле index.ts.